{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Lab Notifications Center - Mahima Medicare</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
    
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="{% static 'HealthStack-System/images/Normal/favicon.png' %}">
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="{% static 'HealthStack-System/css/bootstrap.min.css' %}">
    
    <!-- Fontawesome CSS -->
    <link rel="stylesheet" href="{% static 'HealthStack-System/css/font-awesome.min.css' %}">
    
    <!-- Feathericon CSS -->
    <link rel="stylesheet" href="{% static 'HealthStack-System/css/feathericon.min.css' %}">
    
    <!-- Main CSS -->
    <link rel="stylesheet" href="{% static 'HealthStack-System/css/style.css' %}">
    
<link rel="stylesheet" href="{% static 'css/admin_styles.css' %}"
<link rel="stylesheet" href="{% static 'css/admin_styles.css' %}">
<style>
    .notification-card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 15px;
        border-left: 4px solid #95C270;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        transition: transform 0.2s;
    }
    
    .notification-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    
    .notification-card.urgent {
        border-left-color: #dc3545;
        background: #fff5f5;
    }
    
    .notification-card.info {
        border-left-color: #007bff;
        background: #f8f9ff;
    }
    
    .notification-card.success {
        border-left-color: #28a745;
        background: #f8fff8;
    }
    
    .notification-header {
        display: flex;
        justify-content: between;
        align-items: center;
        margin-bottom: 10px;
    }
    
    .notification-icon {
        font-size: 1.5rem;
        margin-right: 15px;
    }
    
    .notification-time {
        font-size: 0.85rem;
        color: #666;
    }
    
    .notification-actions {
        text-align: right;
        margin-top: 15px;
    }
    
    .mark-read-btn {
        background: none;
        border: 1px solid #95C270;
        color: #95C270;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 0.85rem;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .mark-read-btn:hover {
        background: #95C270;
        color: white;
    }
    
    .notifications-header {
        background: linear-gradient(135deg, #95C270 0%, #7ba05b 100%);
        color: white;
        padding: 30px 0;
        border-radius: 15px;
        margin-bottom: 30px;
        text-align: center;
    }
    
    .filter-tabs {
        margin-bottom: 25px;
        background: white;
        border-radius: 10px;
        padding: 10px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .filter-tabs .nav-link {
        color: #666;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        margin-right: 5px;
    }
    
    .filter-tabs .nav-link.active {
        background: #95C270;
        color: white;
    }
    
    .empty-notifications {
        text-align: center;
        padding: 60px 20px;
        color: #666;
    }
    
    .empty-notifications i {
        font-size: 4rem;
        color: #ccc;
        margin-bottom: 20px;
    }
</style>
</head>

<body>
    <!-- Main Wrapper -->
    <div class="main-wrapper">
        
        <!-- Header -->
        <div class="header">
            <!-- Logo -->
            <div class="header-left">
                <a href="{% url 'labworker-dashboard' %}" class="logo">
                    <img src="{% static 'HealthStack-System/images/Normal/logo.png' %}" alt="Logo">
                </a>
            </div>
            <!-- /Logo -->
            
            <a href="javascript:void(0);" id="toggle_btn">
                <i class="fe fe-text-align-left"></i>
            </a>
            
            <!-- Mobile Menu Toggle -->
            <a class="mobile_btn" id="mobile_btn">
                <i class="fa fa-bars"></i>
            </a>
            <!-- /Mobile Menu Toggle -->
            
            <!-- Header Right Menu -->
            <ul class="nav user-menu">
                <li class="nav-item dropdown noti-dropdown">
                    <a href="#" class="dropdown-toggle nav-link" data-toggle="dropdown">
                        <i class="fe fe-bell"></i> <span class="badge badge-pill">3</span>
                    </a>
                </li>
                
                <li class="nav-item dropdown has-arrow">
                    <a href="#" class="dropdown-toggle nav-link" data-toggle="dropdown">
                        <span class="user-img"><img class="rounded-circle" src="{% static 'HealthStack-System/images/lab-tech-avatar.png' %}" width="31" alt="Lab Tech"></span>
                    </a>
                    <div class="dropdown-menu">
                        <div class="user-header">
                            <div class="avatar avatar-sm">
                                <img src="{% static 'HealthStack-System/images/lab-tech-avatar.png' %}" alt="User Image" class="avatar-img rounded-circle">
                            </div>
                            <div class="user-text">
                                <h6>{{ user.get_full_name|default:user.username }}</h6>
                                <p class="text-muted mb-0">Lab Technician</p>
                            </div>
                        </div>
                        <a class="dropdown-item" href="{% url 'labworker-dashboard' %}">Dashboard</a>
                        <a class="dropdown-item" href="{% url 'lab-technician-order-management' %}">Order Management</a>
                        <a class="dropdown-item" href="{% url 'logout' %}">Logout</a>
                    </div>
                </li>
            </ul>
            <!-- /Header Right Menu -->
        </div>
        <!-- /Header -->
        
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-inner slimscroll">
                <div id="sidebar-menu" class="sidebar-menu">
                    <ul>
                        <li class="menu-title"> 
                            <span>Lab Technician</span>
                        </li>
                        <li>
                            <a href="{% url 'labworker-dashboard' %}"><i class="fe fe-home"></i> <span>Dashboard</span></a>
                        </li>
                        <li>
                            <a href="{% url 'lab-technician-order-management' %}"><i class="fe fe-clipboard"></i> <span>Order Management</span></a>
                        </li>
                        <li class="active">
                            <a href="{% url 'lab-notifications' %}"><i class="fe fe-bell"></i> <span>Notifications</span></a>
                        </li>
                        <li>
                            <a href="{% url 'lab-analytics' %}"><i class="fe fe-bar-chart"></i> <span>Analytics</span></a>
                        </li>
                        <li>
                            <a href="{% url 'test-list' %}"><i class="fe fe-list"></i> <span>Test Catalog</span></a>
                        </li>
                        <li>
                            <a href="{% url 'mypatient-list' %}"><i class="fe fe-users"></i> <span>Patients</span></a>
                        </li>
                        <li>
                            <a href="{% url 'report-history' %}"><i class="fe fe-file-text"></i> <span>Reports</span></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- /Sidebar -->
        
        <!-- Page Wrapper -->
        <div class="page-wrapper"
<div class="container-fluid">
    <!-- Page Header -->
    <div class="notifications-header">
        <div class="container">
            <h1 class="mb-3">
                <i class="fe fe-bell"></i>
                Lab Notifications Center
            </h1>
            <p class="mb-0">Stay updated with test orders, payment notifications, and system alerts</p>
        </div>
    </div>
    
    <!-- Filter Tabs -->
    <div class="filter-tabs">
        <ul class="nav nav-pills" id="notificationTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <a class="nav-link active" id="all-tab" data-toggle="pill" href="#all" role="tab">
                    <i class="fe fe-list"></i> All Notifications
                    {% if total_notifications > 0 %}
                        <span class="badge badge-light ml-2">{{ total_notifications }}</span>
                    {% endif %}
                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="urgent-tab" data-toggle="pill" href="#urgent" role="tab">
                    <i class="fe fe-alert-triangle"></i> Urgent
                    {% if urgent_count > 0 %}
                        <span class="badge badge-danger ml-2">{{ urgent_count }}</span>
                    {% endif %}
                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="orders-tab" data-toggle="pill" href="#orders" role="tab">
                    <i class="fe fe-shopping-cart"></i> Order Updates
                    {% if order_notifications_count > 0 %}
                        <span class="badge badge-primary ml-2">{{ order_notifications_count }}</span>
                    {% endif %}
                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="payments-tab" data-toggle="pill" href="#payments" role="tab">
                    <i class="fe fe-credit-card"></i> Payment Alerts
                    {% if payment_notifications_count > 0 %}
                        <span class="badge badge-info ml-2">{{ payment_notifications_count }}</span>
                    {% endif %}
                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="system-tab" data-toggle="pill" href="#system" role="tab">
                    <i class="fe fe-settings"></i> System
                    {% if system_notifications_count > 0 %}
                        <span class="badge badge-secondary ml-2">{{ system_notifications_count }}</span>
                    {% endif %}
                </a>
            </li>
        </ul>
    </div>
    
    <!-- Notifications Content -->
    <div class="tab-content" id="notificationTabsContent">
        <!-- All Notifications -->
        <div class="tab-pane fade show active" id="all" role="tabpanel">
            {% if recent_notifications %}
                {% for notification in recent_notifications %}
                    <div class="notification-card {% if notification.priority == 'high' %}urgent{% elif notification.type == 'info' %}info{% elif notification.type == 'success' %}success{% endif %}">
                        <div class="notification-header">
                            <div class="d-flex align-items-center">
                                <span class="notification-icon">
                                    {% if notification.type == 'order' %}
                                        <i class="fe fe-shopping-cart text-primary"></i>
                                    {% elif notification.type == 'payment' %}
                                        <i class="fe fe-credit-card text-success"></i>
                                    {% elif notification.type == 'urgent' %}
                                        <i class="fe fe-alert-triangle text-danger"></i>
                                    {% elif notification.type == 'system' %}
                                        <i class="fe fe-settings text-info"></i>
                                    {% else %}
                                        <i class="fe fe-bell text-secondary"></i>
                                    {% endif %}
                                </span>
                                <div>
                                    <h6 class="mb-1">{{ notification.title }}</h6>
                                    <p class="mb-0">{{ notification.message }}</p>
                                </div>
                            </div>
                            <div class="notification-time">
                                <i class="fe fe-clock"></i>
                                {{ notification.created_at|timesince }} ago
                            </div>
                        </div>
                        
                        {% if notification.action_url %}
                            <div class="notification-actions">
                                <a href="{{ notification.action_url }}" class="btn btn-sm btn-outline-primary">
                                    <i class="fe fe-external-link"></i> View Details
                                </a>
                                <button class="mark-read-btn" onclick="markAsRead({{ notification.id }})">
                                    Mark as Read
                                </button>
                            </div>
                        {% else %}
                            <div class="notification-actions">
                                <button class="mark-read-btn" onclick="markAsRead({{ notification.id }})">
                                    Mark as Read
                                </button>
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            {% else %}
                <div class="empty-notifications">
                    <i class="fe fe-bell-off"></i>
                    <h4>No Notifications</h4>
                    <p>You're all caught up! No new notifications at this time.</p>
                </div>
            {% endif %}
        </div>
        
        <!-- Urgent Notifications -->
        <div class="tab-pane fade" id="urgent" role="tabpanel">
            <!-- Sample urgent notifications -->
            <div class="notification-card urgent">
                <div class="notification-header">
                    <div class="d-flex align-items-center">
                        <span class="notification-icon">
                            <i class="fe fe-alert-triangle text-danger"></i>
                        </span>
                        <div>
                            <h6 class="mb-1">Critical Test Results Pending</h6>
                            <p class="mb-0">Patient #12345 - Emergency blood work requires immediate attention</p>
                        </div>
                    </div>
                    <div class="notification-time">
                        <i class="fe fe-clock"></i>
                        15 mins ago
                    </div>
                </div>
                
                <div class="notification-actions">
                    <a href="#" class="btn btn-sm btn-danger">
                        <i class="fe fe-eye"></i> Review Now
                    </a>
                    <button class="mark-read-btn">Mark as Read</button>
                </div>
            </div>
            
            <div class="notification-card urgent">
                <div class="notification-header">
                    <div class="d-flex align-items-center">
                        <span class="notification-icon">
                            <i class="fe fe-clock text-warning"></i>
                        </span>
                        <div>
                            <h6 class="mb-1">Sample Collection Overdue</h6>
                            <p class="mb-0">5 test orders are pending sample collection for more than 2 hours</p>
                        </div>
                    </div>
                    <div class="notification-time">
                        <i class="fe fe-clock"></i>
                        1 hour ago
                    </div>
                </div>
                
                <div class="notification-actions">
                    <a href="{% url 'lab-technician-order-management' %}" class="btn btn-sm btn-warning">
                        <i class="fe fe-list"></i> View Queue
                    </a>
                    <button class="mark-read-btn">Mark as Read</button>
                </div>
            </div>
        </div>
        
        <!-- Order Updates -->
        <div class="tab-pane fade" id="orders" role="tabpanel">
            <div class="notification-card info">
                <div class="notification-header">
                    <div class="d-flex align-items-center">
                        <span class="notification-icon">
                            <i class="fe fe-shopping-cart text-primary"></i>
                        </span>
                        <div>
                            <h6 class="mb-1">New Test Order Received</h6>
                            <p class="mb-0">Order #7890 - Complete Blood Count (CBC) - Payment confirmed</p>
                        </div>
                    </div>
                    <div class="notification-time">
                        <i class="fe fe-clock"></i>
                        30 mins ago
                    </div>
                </div>
                
                <div class="notification-actions">
                    <a href="{% url 'lab-technician-order-management' %}" class="btn btn-sm btn-primary">
                        <i class="fe fe-eye"></i> Process Order
                    </a>
                    <button class="mark-read-btn">Mark as Read</button>
                </div>
            </div>
            
            <div class="notification-card success">
                <div class="notification-header">
                    <div class="d-flex align-items-center">
                        <span class="notification-icon">
                            <i class="fe fe-check-circle text-success"></i>
                        </span>
                        <div>
                            <h6 class="mb-1">Test Completed Successfully</h6>
                            <p class="mb-0">Order #7885 - Lipid Profile results have been uploaded and sent to patient</p>
                        </div>
                    </div>
                    <div class="notification-time">
                        <i class="fe fe-clock"></i>
                        45 mins ago
                    </div>
                </div>
                
                <div class="notification-actions">
                    <button class="mark-read-btn">Mark as Read</button>
                </div>
            </div>
        </div>
        
        <!-- Payment Alerts -->
        <div class="tab-pane fade" id="payments" role="tabpanel">
            <div class="notification-card">
                <div class="notification-header">
                    <div class="d-flex align-items-center">
                        <span class="notification-icon">
                            <i class="fe fe-credit-card text-success"></i>
                        </span>
                        <div>
                            <h6 class="mb-1">COD Payment Collected</h6>
                            <p class="mb-0">â‚¹1,200 collected for Order #7888 - Patient: John Doe</p>
                        </div>
                    </div>
                    <div class="notification-time">
                        <i class="fe fe-clock"></i>
                        2 hours ago
                    </div>
                </div>
                
                <div class="notification-actions">
                    <button class="mark-read-btn">Mark as Read</button>
                </div>
            </div>
            
            <div class="notification-card urgent">
                <div class="notification-header">
                    <div class="d-flex align-items-center">
                        <span class="notification-icon">
                            <i class="fe fe-x-circle text-danger"></i>
                        </span>
                        <div>
                            <h6 class="mb-1">Payment Failed - Action Required</h6>
                            <p class="mb-0">Order #7889 - Contact patient for payment resolution or convert to COD</p>
                        </div>
                    </div>
                    <div class="notification-time">
                        <i class="fe fe-clock"></i>
                        3 hours ago
                    </div>
                </div>
                
                <div class="notification-actions">
                    <a href="{% url 'lab-technician-order-management' %}" class="btn btn-sm btn-danger">
                        <i class="fe fe-tool"></i> Resolve Now
                    </a>
                    <button class="mark-read-btn">Mark as Read</button>
                </div>
            </div>
        </div>
        
        <!-- System Notifications -->
        <div class="tab-pane fade" id="system" role="tabpanel">
            <div class="notification-card info">
                <div class="notification-header">
                    <div class="d-flex align-items-center">
                        <span class="notification-icon">
                            <i class="fe fe-settings text-info"></i>
                        </span>
                        <div>
                            <h6 class="mb-1">System Maintenance Scheduled</h6>
                            <p class="mb-0">Lab management system will undergo maintenance on Sunday, 2:00 AM - 4:00 AM</p>
                        </div>
                    </div>
                    <div class="notification-time">
                        <i class="fe fe-clock"></i>
                        1 day ago
                    </div>
                </div>
                
                <div class="notification-actions">
                    <button class="mark-read-btn">Mark as Read</button>
                </div>
            </div>
            
            <div class="notification-card success">
                <div class="notification-header">
                    <div class="d-flex align-items-center">
                        <span class="notification-icon">
                            <i class="fe fe-check-circle text-success"></i>
                        </span>
                        <div>
                            <h6 class="mb-1">System Update Completed</h6>
                            <p class="mb-0">Lab technician module has been successfully updated with new features</p>
                        </div>
                    </div>
                    <div class="notification-time">
                        <i class="fe fe-clock"></i>
                        2 days ago
                    </div>
                </div>
                
                <div class="notification-actions">
                    <button class="mark-read-btn">Mark as Read</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Actions Bar -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <button class="btn btn-outline-secondary" onclick="markAllAsRead()">
                        <i class="fe fe-check-double"></i> Mark All as Read
                    </button>
                    <button class="btn btn-outline-danger ml-2" onclick="clearAllNotifications()">
                        <i class="fe fe-trash-2"></i> Clear All
                    </button>
                </div>
                <div>
                    <small class="text-muted">
                        <i class="fe fe-refresh-cw"></i> 
                        Auto-refresh every 30 seconds
                    </small>
                </div>
            </div>
        </div>
        </div>
    </div>
    <!-- /Page Wrapper -->
    
</div>
<!-- /Main Wrapper -->

<!-- jQuery -->
<script src="{% static 'HealthStack-System/js/jquery-3.2.1.min.js' %}"></script>

<!-- Bootstrap Core JS -->
<script src="{% static 'HealthStack-System/js/popper.min.js' %}"></script>
<script src="{% static 'HealthStack-System/js/bootstrap.min.js' %}"></script>

<!-- Slimscroll JS -->
<script src="{% static 'HealthStack-System/js/jquery.slimscroll.min.js' %}"></script>

<!-- Custom JS -->
<script src="{% static 'HealthStack-System/js/script.js' %}"
<script>
    $(document).ready(function() {
        // Auto-refresh notifications every 30 seconds
        setInterval(function() {
            // In a real application, this would fetch new notifications via AJAX
            console.log('Auto-refreshing notifications...');
        }, 30000);
        
        // Initialize tooltips
        $('[data-toggle="tooltip"]').tooltip();
    });
    
    function markAsRead(notificationId) {
        // AJAX call to mark notification as read
        $.post('/hospital_admin/mark-notification-read/', {
            'notification_id': notificationId,
            'csrfmiddlewaretoken': $('[name=csrfmiddlewaretoken]').val()
        }, function(response) {
            if (response.success) {
                // Remove or fade out the notification
                $(`[data-notification-id="${notificationId}"]`).fadeOut();
                
                // Show success message
                showNotification('Notification marked as read', 'success');
            }
        });
    }
    
    function markAllAsRead() {
        if (confirm('Mark all notifications as read?')) {
            $.post('/hospital_admin/mark-all-notifications-read/', {
                'csrfmiddlewaretoken': $('[name=csrfmiddlewaretoken]').val()
            }, function(response) {
                if (response.success) {
                    location.reload();
                }
            });
        }
    }
    
    function clearAllNotifications() {
        if (confirm('This will permanently delete all notifications. Are you sure?')) {
            $.post('/hospital_admin/clear-all-notifications/', {
                'csrfmiddlewaretoken': $('[name=csrfmiddlewaretoken]').val()
            }, function(response) {
                if (response.success) {
                    location.reload();
                }
            });
        }
    }
    
    function showNotification(message, type = 'info') {
        // Show toast notification
        const toast = `
            <div class="toast" role="alert" style="position: fixed; top: 20px; right: 20px; z-index: 9999;">
                <div class="toast-header">
                    <i class="fe fe-bell text-${type}"></i>
                    <strong class="mr-auto ml-2">Notification</strong>
                    <button type="button" class="ml-2 mb-1 close" data-dismiss="toast">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="toast-body">
                    ${message}
                </div>
            </div>
        `;
        
        $('body').append(toast);
        $('.toast').toast({delay: 3000}).toast('show');
        
        setTimeout(() => {
            $('.toast').remove();
        }, 4000);
    }
    
    // Real-time notification updates (WebSocket in production)
    function initializeRealTimeNotifications() {
        // This would connect to WebSocket in production
        console.log('Real-time notifications initialized');
    }
    
    // Initialize on page load
    initializeRealTimeNotifications();
</script>
</script>

</body>
</html>